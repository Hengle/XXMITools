{% extends "base.ini" %}

{% if credit -%}
    {% block constants -%}
        [Constants]
        global $active = 0
        global $creditinfo = 0

        [Present]
        post $active = 0
        run = CommandListCreditInfo

    {% endblock %}

    {% block commandlists %}
        [CommandListCreditInfo]
        if $creditinfo == 0 && $active > 0
            pre Resource\ShaderFixes\help.ini\Notification = ResourceCreditInfo
            pre run = CustomShader\ShaderFixes\help.ini\FormatText
            pre $\ShaderFixes\help.ini\notification_timeout = time + 5.0
            $creditinfo = 1
        endif
    {% endblock %}

    {% block resourcecredit -%}
        [ResourceCreditInfo]
        type = Buffer
        data = "Created by {{ credit }}"
    {% endblock -%}
{% endif -%}


{% block overrides -%}
    {% for component in char_hash if component["draw_vb"] != "" -%}
            {% set comp_name = character_name ~ component.component_name -%}
            [TextureOverride{{ comp_name }}Position]
            hash = {{ component.position_vb }}
            vb0 = Resource{{ comp_name }}Position
            vb2 = Resource{{ comp_name }}Blend
            draw = {{ component.total_verts }}, 0
            {% if credit -%}
            $active = 1
            {% endif %}

            [TexyytureOverride{{ comp_name }}Texcoord]
            hash = {{ component.texcoord_vb }}
            vb1 = Resource{{ comp_name }}Texcoord

            [TexyytureOverride{{ comp_name }}VertexLimitRaise]
            hash = {{ component.draw_vb }}
            override_vertex_count = {{ component.total_verts }}
            override_byte_stride = {{ component.strides }}
    {% endfor -%}
    {% for component in char_hash if component["draw_vb"] != "" -%}
        {% block resourcetextures %}
            [Resource{{ character_name ~ component.component_name }}Position]
        {% endblock %}
        {% set offset = 0 -%}
        {% set tabs = "    " -%}
            [TextureOverride{{component.component_name}}IB]
            hash = {{ component.ib }}
            handling = skip
            {% if offsets is not none: -%}
                drawindexed = auto
            {% endif -%}
        {% for object in component.objects -%}
            [TextureOverride{{ object.fullname }}]
            hash = {{ component.ib }}
            ib = Resource{{ object.fullname }}IB
            ps-t0 = Resource{{ object.fullname }}Diffuse
            ps-t1 = Resource{{ object.fullname }}Lightmap
            {% for off in object.offsets -%}
                {% if last_col != off[0] -%}
                    {{- tabs * off[1] }}; {{ off[0] }}
                    {% set last_col = off[0] -%}
                {% endif -%}
                {{ tabs * (off[1] + 1) }}; {{ off[2] }}
                {{ tabs * (off[1] + 1) }}drawindexed = {{ off[3]}}, {{ offset }}, 0
                {% set offset = offset + off[3] -%}
            {% endfor -%}
        {% endfor -%}
    {% endfor %}
{% endblock  %}



{% block resources %}
    {{ self.resourcetextures() }}
    {{ self.resourcecredit() }}
{% endblock %}